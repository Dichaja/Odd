RewriteEngine On

# Enable browser caching
<IfModule mod_expires.c>
  ExpiresActive On

  # Default expiration: 1 month after request
  ExpiresDefault "access plus 1 month"

  # CSS, JavaScript, and JSON files: 1 week
  ExpiresByType text/css "access plus 1 week"
  ExpiresByType application/javascript "access plus 1 week"
  ExpiresByType application/x-javascript "access plus 1 week"
  ExpiresByType text/javascript "access plus 1 week"
  ExpiresByType application/json "access plus 1 week"

  # Images: 1 month
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 month"
  ExpiresByType image/vnd.microsoft.icon "access plus 1 month"

  # Fonts: 1 year
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"

  # HTML and PHP files: 2 hours (shorter to ensure content updates are seen)
  ExpiresByType text/html "access plus 2 hours"
  ExpiresByType application/xhtml+xml "access plus 2 hours"
</IfModule>

# Add Cache-Control headers
<IfModule mod_headers.c>
  # Cache all files by default for 1 month
  <FilesMatch "\.(ico|pdf|jpg|jpeg|png|gif|webp|js|css|swf|svg|woff|woff2|ttf|otf|eot)$">
    Header set Cache-Control "max-age=2592000, public"
  </FilesMatch>

  # Cache CSS and JS files for 1 week
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "max-age=604800, public"
  </FilesMatch>

  # Don't cache PHP files
  <FilesMatch "\.(php)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
  </FilesMatch>
</IfModule>

# Redirect admin/ to dashboard
RewriteRule ^admin/?$ admin/dashboard [L,R=301]
RewriteRule ^account/?$ account/dashboard [L,R=301]

# Block direct access to the /config directory
RewriteRule ^config(/.*)?$ - [F,L]

# Custom error documents
ErrorDocument 404 /404.php
ErrorDocument 403 /403.php

# Authentication API endpoints (SEO friendly)
RewriteRule ^auth/checkUser$ login/handleAuth.php?action=checkUser [L,QSA]
RewriteRule ^auth/login$ login/handleAuth.php?action=login [L,QSA]
RewriteRule ^auth/checkUsername$ login/handleAuth.php?action=checkUsername [L,QSA]
RewriteRule ^auth/checkEmail$ login/handleAuth.php?action=checkEmail [L,QSA]
RewriteRule ^auth/checkPhone$ login/handleAuth.php?action=checkPhone [L,QSA]
RewriteRule ^auth/sendEmailOTP$ login/handleAuth.php?action=sendEmailOTP [L,QSA]
RewriteRule ^auth/verifyEmailOTP$ login/handleAuth.php?action=verifyEmailOTP [L,QSA]
RewriteRule ^auth/sendPhoneOTP$ login/handleAuth.php?action=sendPhoneOTP [L,QSA]
RewriteRule ^auth/verifyPhoneOTP$ login/handleAuth.php?action=verifyPhoneOTP [L,QSA]
RewriteRule ^auth/register$ login/handleAuth.php?action=register [L,QSA]
RewriteRule ^auth/sendResetEmail$ login/handleAuth.php?action=sendResetEmail [L,QSA]
RewriteRule ^auth/sendResetPhone$ login/handleAuth.php?action=sendResetPhone [L,QSA]
RewriteRule ^auth/verifyResetOTP$ login/handleAuth.php?action=verifyResetOTP [L,QSA]
RewriteRule ^auth/resetPassword$ login/handleAuth.php?action=resetPassword [L,QSA]
RewriteRule ^auth/logout$ login/handleAuth.php?action=logout [L,QSA]

# Rewrite rules for clean URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^about-us$ about-us.php [L]
RewriteRule ^request-for-quote$ request-for-quote.php [L]
RewriteRule ^contact-us$ contact-us.php [L]
RewriteRule ^products-page$ products-page.php [L]

# Admin section clean URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^admin/dashboard$ admin/dashboard.php [L]
RewriteRule ^admin/mapping$ admin/mapping.php [L]
RewriteRule ^admin/cash-account$ admin/cash-account.php [L]
RewriteRule ^admin/manage-products$ admin/manage-products.php [L]
RewriteRule ^admin/manage-vendors$ admin/manage-vendors.php [L]
RewriteRule ^admin/zzimba-credit$ admin/zzimba-credit.php [L]
RewriteRule ^admin/fundi$ admin/fundi.php [L]
RewriteRule ^admin/order-catalogue$ admin/order-catalogue.php [L]
RewriteRule ^admin/member-subscription$ admin/member-subscription.php [L]
RewriteRule ^admin/quotations$ admin/quotations.php [L]
RewriteRule ^admin/search-log$ admin/search-log.php [L]
RewriteRule ^admin/ads-management$ admin/ads-management.php [L]
RewriteRule ^admin/page-activity$ admin/page-activity.php [L]
RewriteRule ^admin/ad-submissions$ admin/ad-submissions.php [L]
RewriteRule ^admin/schedule-ads$ admin/schedule-ads.php [L]
RewriteRule ^admin/notifications$ admin/notifications.php [L]
RewriteRule ^admin/sessions$ admin/sessions.php [L] 
RewriteRule ^admin/product-package$ admin/product-package.php [L]
RewriteRule ^admin/vendor-categories$ admin/vendor-categories.php [L]
RewriteRule ^admin/vendor-profile$ admin/vendor-profile.php [L]
RewriteRule ^admin/users$ admin/users.php [L]
RewriteRule ^admin/profile$ admin/profile.php [L]

# User's section clean URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^account/dashboard$ account/dashboard.php [L]
RewriteRule ^account/order-history$ account/order-history.php [L]
RewriteRule ^account/zzimba-credit$ account/zzimba-credit.php [L]
RewriteRule ^account/notifications$ account/notifications.php [L]
RewriteRule ^account/profile$ account/profile.php [L]

# General Rule for Fetch Folder (For All Files)
# Rewrite fetch/{filename}/{action} → fetch/{filename}.php?action={action}
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^fetch/([^/]+)/([^/]+)$ fetch/$1.php?action=$2 [L,QSA]

# Rewrite fetch/{filename} → fetch/{filename}.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^fetch/([^/]+)$ fetch/$1.php [L]

# General Rule for Admin Fetch Folder (For All Files)
# Rewrite fetch/{filename}/{action} → fetch/{filename}.php?action={action}
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^admin/fetch/([^/]+)/([^/]+)$ admin/fetch/$1.php?action=$2 [L,QSA]

# Rewrite admin/fetch/{filename} → admin/fetch/{filename}.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^admin/fetch/([^/]+)$ admin/fetch/$1.php [L]

# General rule for other files to work without .php extension
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/.]+)$ $1.php [L]